<!-- VERSION 35.0: EXTERNAL DB + REAL PROFILE + ORIGINAL UI -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flower Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- ПОДКЛЮЧАЕМ ДИНАМИЧЕСКУЮ БАЗУ ДАННЫХ -->
    <script src="catalog.js"></script>
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,600;1,600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* --- COLORS --- */
            --bg: #000000;
            --block: #1C1C1E;
            --text: #FFFFFF;
            --text-sec: #8E8E93;
            --input-bg: #2C2C2E;
            --accent: #E75A7C;
            --green: #32D74B;
            --red: #FF453A;
            --border: rgba(255,255,255,0.1);
            --shadow-color: rgba(0,0,0,0.3);
            
            --header-glass: rgba(20, 30, 25, 0.4); 
            --nav-glass: rgba(28, 28, 30, 0.6);
            --footer-glass: rgba(28, 28, 30, 0.8); 
            --glass-blur: blur(20px);
            
            --glass-btn: rgba(0, 0, 0, 0.3);
        }

        body.light-theme {
            --bg: #F2F2F7;
            --block: #FFFFFF;
            --text: #000000;
            --text-sec: #8E8E93;
            --input-bg: #E5E5EA;
            --border: rgba(0,0,0,0.1);
            --shadow-color: rgba(0,0,0,0.05);
            
            --header-glass: rgba(230, 240, 235, 0.6);
            --nav-glass: rgba(255, 255, 255, 0.8);
            --footer-glass: rgba(255, 255, 255, 0.8);
            
            --glass-btn: rgba(255, 255, 255, 0.6);
        }

        html { height: 100%; overflow: hidden; }
        body {
            height: 100%; margin: 0; padding: 0; overflow: hidden;
            background: var(--bg); color: var(--text);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none; user-select: none;
            transition: background 0.3s;
        }

        .app-container {
            display: flex; flex-direction: column; height: 100%; overflow: hidden; position: relative;
        }

        /* --- ICONS --- */
        .icon { width: 20px; height: 20px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .icon-sm { width: 16px; height: 16px; }
        .icon-lg { width: 24px; height: 24px; }
        .icon-xl { width: 48px; height: 48px; stroke-width: 1.5; color: var(--text-sec); opacity: 0.5; }

        /* --- HEADER --- */
        header { 
            flex-shrink: 0; height: 63px; 
            background-color: var(--header-glass);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            z-index: 20; padding: 0; position: absolute; top: 0; left: 0; width: 100%;
            border-bottom: 1px solid rgba(255,255,255,0.1); 
            overflow: hidden; border-radius: 0 0 24px 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        #header-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: block; z-index: 1; }

        .brand-overlay { 
            position: absolute; bottom: 8px; width: 100%; text-align: center;
            font-family: 'Playfair Display', serif; font-style: italic; font-weight: 600; 
            font-size: 24px; letter-spacing: 1px; color: #fff; 
            text-shadow: 0 2px 15px rgba(0,0,0,0.8); pointer-events: none; z-index: 2;
        }

        /* --- NAV --- */
        nav {
            flex-shrink: 0; height: 70px; 
            background: var(--nav-glass); 
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            display: flex; justify-content: space-around; align-items: center; z-index: 50;
            padding-bottom: env(safe-area-inset-bottom);
            position: absolute; bottom: 0; left: 0; width: 100%;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.2);
        }

        .page {
            display: none; width: 100%; height: 100%; overflow-y: scroll; 
            padding-top: 75px; padding-bottom: 90px; box-sizing: border-box;
            overscroll-behavior-y: contain; -webkit-overflow-scrolling: touch; 
        }
        .page.active { display: block; }

        /* --- SNOW --- */
        #snow-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; overflow: hidden; }
        .snowflake { position: absolute; top: -10px; color: white; font-size: 1em; opacity: 0.8; user-select: none; animation-name: fall; animation-timing-function: linear; }
        @keyframes fall {
            0% { transform: translateY(-10px) translateX(0px) rotate(0deg); }
            50% { transform: translateY(55vh) translateX(15px) rotate(180deg); }
            100% { transform: translateY(110vh) translateX(-15px) rotate(360deg); }
        }

        /* --- COMMON UI --- */
        .ptr-spinner { height: 0; overflow: hidden; display: flex; align-items: center; justify-content: center; transition: height 0.2s; width: 100%; flex-shrink: 0; margin-top: -10px; }
        .ptr-icon { width: 20px; height: 20px; border: 2px solid var(--border); border-top: 2px solid var(--accent); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        img { -webkit-touch-callout: none; -webkit-user-drag: none; pointer-events: auto; }
        
        .check-circle { width: 20px; height: 20px; border: 2px solid var(--text-sec); border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: 0.2s; flex-shrink: 0; cursor: pointer; }
        .check-circle.checked { background: var(--accent); border-color: var(--accent); }
        .check-circle svg { width: 12px; height: 12px; stroke: white; stroke-width: 3; opacity: 0; transform: scale(0.5); transition: 0.2s; }
        .check-circle.checked svg { opacity: 1; transform: scale(1); }

        .clean-btn { background: none; border: none; padding: 5px; color: var(--red); font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 5px; cursor: pointer; border-radius: 8px; transition: background 0.2s; }
        .clean-btn:active { background: rgba(255, 69, 58, 0.1); }
        .sel-all-btn { color: var(--accent); font-size: 14px; background: none; border: none; cursor: pointer; font-weight: 500; }

        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pop { 50% { transform: scale(1.2); } }

        .search-wrap { padding: 0 16px 12px 16px; position: relative;}
        .search-input { width: 100%; padding: 10px 12px 10px 40px; border-radius: 10px; border: none; background: var(--input-bg); color: var(--text); font-size: 16px; outline: none; box-sizing: border-box; }
        .search-icon-abs { position: absolute; left: 28px; top: 10px; color: var(--text-sec); pointer-events: none; }
        
        .grid { display: grid; gap: 12px; padding: 0 16px; grid-template-columns: 1fr 1fr; }
        @media (min-width: 600px) { .grid { grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); } }
        
        .card { background: var(--block); border-radius: 14px; overflow: hidden; position: relative; animation: fadeUp 0.4s backwards; cursor: pointer; box-shadow: 0 4px 15px var(--shadow-color); }
        .card:active { transform: scale(0.97); transition: 0.1s; }
        .slider-wrapper { position: relative; width: 100%; height: 170px; overflow: hidden; }
        .slider { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; height: 100%; scrollbar-width: none; }
        .slider::-webkit-scrollbar { display: none; }
        .slide { min-width: 100%; height: 100%; scroll-snap-align: center; }
        .slide img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .dots { position: absolute; bottom: 8px; left: 0; width: 100%; display: flex; justify-content: center; gap: 4px; pointer-events: none; }
        .dot { width: 4px; height: 4px; background: rgba(255,255,255,0.5); border-radius: 50%; }

        .fav-btn { position: absolute; top: 8px; right: 8px; width: 30px; height: 30px; background: rgba(30, 30, 30, 0.6); backdrop-filter: blur(5px); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 5; }
        .light-theme .fav-btn { background: rgba(255,255,255,0.8); }
        .fav-btn.is-active svg { fill: var(--red); stroke: var(--red); }
        .fav-btn.active-anim { animation: pop 0.3s ease; }

        .cart-btn { position: absolute; bottom: 10px; right: 10px; width: 34px; height: 34px; background: var(--accent); color: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 5; }
        .cart-btn:active { transform: scale(0.9); background: var(--green); }

        .info { padding: 10px; padding-right: 45px; }
        .name { font-weight: 500; font-size: 13px; margin-bottom: 4px; height: 32px; line-height: 1.25; overflow: hidden; color: var(--text); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        .price { font-weight: 700; font-size: 14px; color: var(--text); }
        
        .list-row { display: flex; align-items: center; gap: 12px; background: var(--block); padding: 10px; margin: 10px 16px; border-radius: 12px; animation: fadeUp 0.3s; }
        .list-img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; }
        .cart-item-name { font-weight: 500; font-size: 13px; line-height: 1.3; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        .cart-item-price { color: var(--text-sec); font-size: 13px; margin-top: 2px; }
        .qty-ctrl { display: flex; align-items: center; gap: 10px; background: var(--input-bg); padding: 4px; border-radius: 8px; margin-top: 5px; width: fit-content; }
        .qty-btn { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; background: var(--bg); color: var(--text); border-radius: 6px; font-weight: bold; cursor: pointer; }
        .qty-val { font-weight: 600; min-width: 16px; text-align: center; font-size: 14px; color: var(--text); }

        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #636366; background: none; border: none; cursor: pointer; width: 25%; height: 100%; transition: color 0.2s; }
        .nav-icon { width: 22px; height: 22px; margin-bottom: 3px; stroke: #636366; stroke-width: 2; transition: stroke 0.2s; }
        .nav-item.active { color: var(--accent); }
        .nav-item.active .nav-icon { stroke: var(--accent); }
        .badge { position: absolute; top: 8px; margin-left: 14px; background: var(--red); color: white; font-size: 9px; font-weight: bold; padding: 1px 5px; border-radius: 8px; display: none; animation: pop 0.3s; z-index: 10; }

        /* MODALS */
        #modal, #settings-modal, #checkout-modal, #info-modal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: var(--bg); z-index: 100; 
        }

        .modal-active { display: block !important; animation: fadeUp 0.3s; }

        #modal { overflow-y: hidden; }
        #checkout-modal, #settings-modal, #info-modal {
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch; 
            overscroll-behavior-y: contain;
        }
        
        .modal-top-bar {
            position: absolute; top: 0; left: 0; width: 100%; height: 60px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; padding-top: env(safe-area-inset-top);
            z-index: 50; 
            background: transparent;
            transition: background 0.4s ease, border-bottom 0.4s ease, height 0.4s ease, border-radius 0.4s ease;
            box-sizing: border-box;
            border-radius: 0 0 24px 24px;
        }
        
        .modal-top-bar.scrolled {
            background: var(--block);
            height: 52px;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 4px 20px var(--shadow-color);
        }
        
        .glass-btn {
            width: 40px; height: 40px; border-radius: 50%;
            background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: center;
            color: #fff; border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer; transition: all 0.3s;
        }
        
        .modal-top-bar.scrolled .glass-btn {
            background: transparent; border-color: transparent; backdrop-filter: none;
            width: 34px; height: 34px;
            color: var(--text);
        }

        .glass-btn:active { transform: scale(0.9); }
        .glass-btn.active svg { fill: var(--red); stroke: var(--red); }

        .modal-scroll-container {
            width: 100%; height: 100%;
            overflow-y: auto; -webkit-overflow-scrolling: touch;
            padding: 0 0 140px 0; 
            box-sizing: border-box;
        }

        .product-card-main {
            background: var(--block);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 4px 15px var(--shadow-color);
            margin: 8px 8px 12px 8px;
        }

        .modal-slider-wrap { 
            width: 100%; aspect-ratio: 1 / 1.1; 
            overflow: hidden; position: relative; background: transparent;
        }
        
        .modal-slider { 
            display: flex; overflow-x: auto; scroll-snap-type: x mandatory; 
            height: 100%; scrollbar-width: none; 
            padding: 0 4px;
        }
        .modal-slider::-webkit-scrollbar { display: none; }
        
        .modal-slide { 
            min-width: 100%; height: 100%; scroll-snap-align: center; 
            display:flex; align-items:center; justify-content:center; position: relative;
            padding: 0 4px;
            box-sizing: border-box;
        }
        
        .modal-slide img { 
            width: 100%; height: 100%; object-fit: cover; display: block; 
            border-radius: 20px;
        }
        
        .modal-dots { position: absolute; bottom: 15px; left: 0; width: 100%; display: flex; justify-content: center; gap: 6px; pointer-events: none; z-index: 5; }
        .modal-dot { width: 6px; height: 6px; background: rgba(255,255,255,0.4); border-radius: 50%; transition: 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .modal-dot.active { background: #fff; transform: scale(1.2); }

        .modal-info-inner { padding: 15px 20px 25px 20px; }

        .modal-title { font-size: 22px; font-weight: 700; line-height: 1.3; margin-bottom: 12px; color: var(--text); }

        .price-row { display: flex; align-items: flex-end; gap: 10px; margin-bottom: 20px; }
        .current-price { font-size: 28px; font-weight: 800; color: var(--text); line-height: 1; }
        .old-price { font-size: 16px; color: var(--text-sec); text-decoration: line-through; margin-bottom: 4px; }
        .discount-badge { background: var(--red); color: white; font-size: 13px; font-weight: 700; padding: 2px 8px; border-radius: 6px; margin-bottom: 5px; }
        
        .delivery-row { display: flex; align-items: center; gap: 10px; font-weight: 600; font-size: 14px; margin-bottom: 10px; color: var(--text); }
        .delivery-row svg { flex-shrink: 0; color: var(--accent); }

        .product-card-desc {
            background: var(--block);
            border-radius: 24px;
            padding: 20px;
            margin: 0 8px 20px 8px;
            box-shadow: 0 4px 15px var(--shadow-color);
        }
        
        .desc-title { font-size: 16px; font-weight: 700; margin-bottom: 10px; color: var(--text); }
        .desc-text { font-size: 15px; line-height: 1.6; color: var(--text-sec); white-space: pre-wrap; }

        #lightbox { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 200; touch-action: none; flex-direction: column; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; }
        #lightbox.visible { opacity: 1; }
        #lightbox-img { max-width: 100%; max-height: 100%; object-fit: contain; transform-origin: center; transition: transform 0.1s linear; }
        .lightbox-close { position: absolute; top: 20px; right: 20px; width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; cursor: pointer; z-index: 201; }

        .back-btn { position: absolute; top: 15px; left: 15px; width: 40px; height: 40px; background: rgba(0,0,0,0.3); backdrop-filter: blur(10px); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 20; }
        
        .big-btn { width: 100%; padding: 16px; background: var(--accent); color: white; border: none; border-radius: 14px; font-size: 16px; font-weight: 700; margin-top: 12px; cursor: pointer; box-shadow: 0 5px 15px rgba(231, 90, 124, 0.3); transition: all 0.3s; }
        .big-btn:disabled { background: var(--input-bg); color: var(--text-sec); box-shadow: none; cursor: not-allowed; opacity: 0.6; }

        .input-group { position: relative; margin-bottom: 15px; }
        
        .checkout-input, .checkout-textarea, .checkout-select { width: 100%; padding: 14px 14px 14px 45px; border-radius: 10px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text); font-size: 16px; outline: none; box-sizing: border-box; transition: border-color 0.2s; }
        .checkout-input:focus, .checkout-textarea:focus { border-color: var(--accent); }
        .checkout-textarea { resize: vertical; min-height: 80px; padding-left: 14px; }
        .input-icon { position: absolute; left: 14px; top: 14px; color: var(--text-sec); pointer-events: none; }

        .promo-wrap { display: flex; gap: 8px; margin-bottom: 15px; }
        .promo-btn { background: var(--block); border: 1px solid var(--border); color: var(--text); border-radius: 10px; padding: 0 15px; font-weight: 600; font-size: 14px; cursor: pointer; }
        .promo-status { font-size: 13px; margin-top: -8px; margin-bottom: 12px; }
        .promo-success { color: var(--green); }
        .promo-error { color: var(--red); }

        .input-label { display: block; font-size: 13px; font-weight: 500; color: var(--text-sec); margin-bottom: 6px; margin-left: 4px; }
        
        #address-suggestions { position: absolute; top: 100%; left: 0; right: 0; z-index: 10; background: var(--block); border: 1px solid var(--border); border-top: none; border-radius: 0 0 10px 10px; box-shadow: 0 4px 10px var(--shadow-color); max-height: 250px; overflow-y: auto; }
        .suggestion-item { padding: 12px 14px; font-size: 15px; cursor: pointer; border-bottom: 1px solid var(--border); color: var(--text); }
        .suggestion-item:last-child { border-bottom: none; }
        
        .head-row { display: flex; justify-content: space-between; align-items: center; padding: 0 16px; margin-top: 15px; margin-bottom: 10px; }
        .head-title { font-size: 20px; font-weight: 800; margin: 0; }
        
        .settings-item { display: flex; justify-content: space-between; align-items: center; padding: 16px; background: var(--block); margin-bottom: 1px; cursor: pointer; }
        .settings-item:first-child { border-radius: 14px 14px 0 0; }
        .settings-item:last-child { border-radius: 0 0 14px 14px; }
        .settings-left { display: flex; align-items: center; gap: 12px; font-weight: 500; }
        .settings-icon { color: var(--text-sec); }
        .settings-arrow { color: var(--text-sec); opacity: 0.5; }

        .toggle-switch { position: relative; width: 50px; height: 30px; }
        .toggle-input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #39393D; transition: .4s; border-radius: 34px; }
        .light-theme .toggle-slider { background-color: #E9E9EA; }
        .toggle-slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .toggle-input:checked + .toggle-slider { background-color: var(--green); }
        .toggle-input:checked + .toggle-slider:before { transform: translateX(20px); }
        
        .empty-state { text-align: center; color: var(--text-sec); margin-top: 60px; font-size: 15px; display:flex; flex-direction:column; align-items:center; gap:15px; }
        
        /* --- PREMIUM INFO CARDS --- */
        .info-card {
            background: var(--block);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px var(--shadow-color);
            border: 1px solid var(--border);
        }

        /* TEXT STYLING: LEFT ALIGN, LEGIBLE */
        .legal-text {
            color: var(--text-sec);
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            text-align: left; /* FIX: Left Align */
        }
        
        .legal-text h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--text);
            margin-top: 20px;
            margin-bottom: 8px;
            text-align: left;
        }
        .legal-text h3:first-child { margin-top: 0; }
        .legal-text b { color: var(--text); }
        
        .info-block { display: flex; flex-direction: column; gap: 8px; }
        .info-row { display: flex; justify-content: space-between; font-size: 14px; padding: 4px 0; border-bottom: 1px solid var(--border); }
        .info-row:last-child { border-bottom: none; }
        .info-label { color: var(--text-sec); }
        .info-val { font-weight: 500; text-align: right; max-width: 65%; color: var(--text); word-break: break-all; }

        /* DELIVERY ICONS GRID */
        .delivery-svg-list { display: flex; flex-direction: column; gap: 15px; }
        .delivery-svg-item { display: flex; gap: 15px; align-items: flex-start; }
        .delivery-icon-box { 
            width: 44px; height: 44px; border-radius: 50%; 
            background: rgba(231, 90, 124, 0.1); display: flex; align-items: center; justify-content: center; 
            flex-shrink: 0; color: var(--accent);
        }
        .delivery-text-box h4 { margin: 0 0 4px 0; font-size: 15px; font-weight: 600; color: var(--text); }
        .delivery-text-box p { margin: 0; font-size: 13px; color: var(--text-sec); line-height: 1.4; }

        .legal-row { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 0; }
        .custom-checkbox { width: 20px; height: 20px; border: 2px solid var(--text-sec); border-radius: 5px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; cursor: pointer; transition: 0.2s; }
        .custom-checkbox.checked { background: var(--accent); border-color: var(--accent); }
        .custom-checkbox svg { width: 14px; height: 14px; stroke: white; opacity: 0; transition: 0.2s; }
        .custom-checkbox.checked svg { opacity: 1; }
        .legal-label { font-size: 12px; color: var(--text-sec); line-height: 1.4; cursor: pointer; }
        .legal-link { color: var(--accent); text-decoration: underline; cursor: pointer; font-weight: 600; }
        
        .delivery-details-box {
            background: var(--block);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
            display: none; 
        }
        .dd-row { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 6px; }
        .dd-row:last-child { margin-bottom: 0; }
        .dd-label { color: var(--text-sec); }
        .dd-val { font-weight: 600; color: var(--text); }
        .dd-accent { color: var(--accent); }

        .date-scroll { display: flex; overflow-x: auto; gap: 8px; margin-bottom: 15px; scrollbar-width: none; padding-bottom: 5px; }
        .date-scroll::-webkit-scrollbar { display: none; }
        .date-chip { 
            flex-shrink: 0; padding: 10px 16px; background: var(--block); border: 1px solid var(--border); 
            border-radius: 10px; color: var(--text); font-size: 14px; cursor: pointer; text-align: center; min-width: 70px;
        }
        .date-chip.selected { background: var(--accent); border-color: var(--accent); color: white; box-shadow: 0 4px 10px rgba(231, 90, 124, 0.3); }
        
        .time-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 5px; }
        .time-slot { 
            padding: 10px; background: var(--block); border: 1px solid var(--border); border-radius: 10px; 
            color: var(--text); font-size: 13px; text-align: center; cursor: pointer; transition: 0.2s;
        }
        .time-slot.disabled { opacity: 0.4; cursor: not-allowed; pointer-events: none; background: rgba(100,100,100,0.1); }
        .time-slot.selected { background: var(--accent); border-color: var(--accent); color: white; }

        .checkout-footer, .modal-footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--footer-glass);
            backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
            border-top: 1px solid var(--border);
            padding: 15px 20px; z-index: 120;
            box-shadow: 0 -5px 20px var(--shadow-color);
            padding-bottom: calc(20px + env(safe-area-inset-bottom));
            box-sizing: border-box;
            border-radius: 24px 24px 0 0;
            transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
            will-change: transform;
        }
        
        .checkout-footer.hidden { transform: translateY(120%); }
        #order-form { padding-bottom: 160px; }
        .static-footer-block { margin-top: 30px; padding-bottom: 30px; }

        .modal-footer { display: flex; gap: 10px; align-items: center; justify-content: space-between; }
        
        .action-btn { flex: 1; padding: 14px; border: none; border-radius: 14px; font-weight: 600; font-size: 15px; cursor: pointer; transition: 0.2s; text-align: center; }
        .buy-now { background: rgba(255,255,255,0.1); color: var(--text); border: 1px solid var(--border); backdrop-filter: blur(5px); }
        .buy-now:active { background: rgba(255,255,255,0.2); }
        .add-cart { background: var(--accent); color: white; box-shadow: 0 4px 15px rgba(231, 90, 124, 0.4); }
        .add-cart:active { transform: scale(0.96); }

        .modal-qty-ctrl { display: flex; align-items: center; justify-content: space-between; background: var(--accent); border-radius: 14px; padding: 6px; flex: 1; height: 46px; box-sizing: border-box; box-shadow: 0 4px 15px rgba(231, 90, 124, 0.4);}
        .modal-qty-btn { width: 36px; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px; cursor: pointer; }
        .modal-qty-val { color: white; font-weight: 700; font-size: 16px; min-width: 20px; text-align: center; }
    </style>
</head>
<body>

    <div class="app-container">
        <!-- HEADER -->
        <header id="main-header">
            <canvas id="header-canvas"></canvas>
            <div class="brand-overlay">Cotton Flowers</div>
        </header>

        <!-- PAGE: HOME -->
        <div id="p-home" class="page active">
            <div class="ptr-spinner"><div class="ptr-icon"></div></div>
            <div class="search-wrap">
                <svg class="icon search-icon-abs" viewBox="0 0 24 24"><path d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"/></svg>
                <input type="text" class="search-input" data-lang-ph="search_ph" placeholder="Поиск цветов..." oninput="doSearch(this.value)">
            </div>
            <div class="grid" id="grid"></div>
        </div>

        <!-- PAGE: CART -->
        <div id="p-cart" class="page">
            <div class="ptr-spinner"><div class="ptr-icon"></div></div>
            <div class="head-row">
                <h2 class="head-title" data-lang="cart">Корзина</h2>
                <div style="display:flex; gap:10px">
                    <button class="clean-btn" id="cart-del-btn" onclick="deleteSelectedCart()" style="display:none">
                        <svg class="icon icon-sm" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                        <span data-lang="delete">Удалить</span>
                    </button>
                    <button class="sel-all-btn" onclick="toggleAllCart()" data-lang="select_all">Выбрать все</button>
                </div>
            </div>
            <div id="cart-items"></div>
            <div class="empty-state" id="cart-empty" style="display:none">
                <svg class="icon icon-xl" viewBox="0 0 24 24"><path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
                <span data-lang="cart_empty">Корзина пуста</span>
            </div>
            <div id="cart-footer" style="padding: 15px; max-width: 600px; margin: 0 auto; display:none">
                <div style="text-align: right; font-weight: 600; font-size: 18px; margin-bottom: 15px;">
                    <span data-lang="total">Итого:</span> <span id="total-price" style="color: var(--accent)">0</span> ₽
                </div>
                <button class="big-btn" id="checkout-btn" onclick="openCheckoutModal()" disabled data-lang="order_btn">ОФОРМИТЬ ЗАКАЗ</button>
            </div>
        </div>

        <!-- PAGE: FAV -->
        <div id="p-fav" class="page">
            <div class="ptr-spinner"><div class="ptr-icon"></div></div>
            <div class="head-row">
                <h2 class="head-title" data-lang="fav">Избранное</h2>
                <div style="display:flex; gap:15px">
                    <button class="clean-btn" onclick="clearFav()">
                        <svg class="icon icon-sm" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                        <span data-lang="clear">Очистить</span>
                    </button>
                </div>
            </div>
            <div class="grid" id="fav-items"></div>
            <div class="empty-state" id="fav-empty" style="display:none">
                <svg class="icon icon-xl" viewBox="0 0 24 24"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
                <span data-lang="fav_empty">Нет избранных товаров</span>
            </div>
        </div>

        <!-- PAGE: PROFILE (UPDATED WITH REAL DATA) -->
        <div id="p-prof" class="page">
            <div class="ptr-spinner"><div class="ptr-icon"></div></div>
            <div style="text-align: center; padding: 40px 20px;">
                <!-- REAL PROFILE IMAGE CONTAINER -->
                <div style="width: 80px; height: 80px; background: var(--block); border-radius: 50%; margin: 0 auto 15px; display:flex; align-items:center; justify-content:center; border: 2px solid var(--border); overflow:hidden" id="u-ava">
                    <!-- JS INJECTS HERE -->
                </div>
                <h2 id="u-name" style="margin: 0; font-size: 20px;">Guest</h2>
                <div id="u-username" style="color: var(--accent); margin-top: 5px;"></div>
            </div>
            
            <!-- (ОСТАЛЬНОЙ HTML ПРОФИЛЯ БЕЗ ИЗМЕНЕНИЙ) -->
             <div style="padding: 0 16px; max-width: 600px; margin: 0 auto;">
                <div class="settings-item" onclick="openInfo('delivery')">
                    <div class="settings-left">
                        <svg class="icon settings-icon" viewBox="0 0 24 24"><path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"/></svg>
                        <span data-lang="menu_delivery">Доставка и упаковка</span>
                    </div>
                    <svg class="icon icon-sm settings-arrow" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7" /></svg>
                </div>
                <div class="settings-item" onclick="openInfo('contacts')">
                    <div class="settings-left">
                        <svg class="icon settings-icon" viewBox="0 0 24 24"><path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                        <span data-lang="menu_contacts">Контакты и реквизиты</span>
                    </div>
                    <svg class="icon icon-sm settings-arrow" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7" /></svg>
                </div>
                <div class="settings-item" onclick="openSupport()">
                    <div class="settings-left">
                        <svg class="icon settings-icon" viewBox="0 0 24 24"><path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                        <span data-lang="menu_support">Поддержка в Telegram</span>
                    </div>
                    <svg class="icon icon-sm settings-arrow" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7" /></svg>
                </div>
                <div class="settings-item" onclick="openSettings()">
                    <div class="settings-left">
                        <svg class="icon settings-icon" viewBox="0 0 24 24"><path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                        <span data-lang="menu_settings">Настройки</span>
                    </div>
                    <svg class="icon icon-sm settings-arrow" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7" /></svg>
                </div>
            </div>
        </div>

        <!-- NAVBAR -->
        <nav>
            <button class="nav-item active" onclick="go('home', this)">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                <span class="nav-text" data-lang="nav_catalog">Каталог</span>
            </button>
            <button class="nav-item" style="position:relative" onclick="go('cart', this)">
                <span class="badge" id="badge">0</span>
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
                <span class="nav-text" data-lang="nav_cart">Корзина</span>
            </button>
            <button class="nav-item" onclick="go('fav', this)">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
                <span class="nav-text" data-lang="nav_fav">Избранное</span>
            </button>
            <button class="nav-item" onclick="go('prof', this)">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                <span class="nav-text" data-lang="nav_profile">Профиль</span>
            </button>
        </nav>
    </div>
    
    <div id="snow-container"></div>

    <!-- (ЗДЕСЬ ВСТАВЬ ВЕСЬ ОСТАЛЬНОЙ HTML МОДАЛОК БЕЗ ИЗМЕНЕНИЙ, ОН У ТЕБЯ ЕСТЬ) -->
    <!-- ... LIGHTBOX, MODAL, CHECKOUT, ETC ... -->
    <!-- ДЛЯ ЭКОНОМИИ МЕСТА Я НЕ ДУБЛИРУЮ ИХ, ТАК КАК ТЫ ИХ НЕ МЕНЯЛ -->
    <div id="modal">
        <div class="modal-top-bar" id="modal-top-bar">
            <div class="glass-btn" onclick="closeModal()">
                <svg class="icon" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7" /></svg>
            </div>
            <!-- ... -->
        </div>
        <div class="modal-scroll-container" id="modal-scroll">
            <div class="product-card-main">
                <div class="modal-slider-wrap">
                    <div class="modal-slider" id="m-slider"></div>
                    <div class="modal-dots" id="m-dots"></div>
                </div>
                <div class="modal-info-inner">
                    <h1 id="m-title" class="modal-title"></h1>
                    <div class="price-row">
                        <div class="current-price" id="m-price"></div>
                        <div class="old-price" id="m-old-price"></div>
                        <div class="discount-badge" id="m-discount">-20%</div>
                    </div>
                    <!-- ... -->
                     <div class="product-card-desc">
                        <div class="desc-title" data-lang="desc_title">Описание</div>
                        <p id="m-desc" class="desc-text"></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer" id="modal-footer"></div>
    </div>
    
    <!-- (ПРОДОЛЖАЙ ВСТАВЛЯТЬ ОСТАЛЬНЫЕ МОДАЛКИ: CHECKOUT, SETTINGS, INFO - ОНИ НЕ МЕНЯЛИСЬ) -->

    <!-- СКРИПТЫ -->
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // ⬇️ ВАШ БОТ
        const BOT_USERNAME = 'Cotton_Flowers_Bot'; 
        const SUPPORT_USERNAME = 'Cotton_FIowers'; 
        const DADATA_TOKEN = '69386c882701ec813abcc78b9973d255aacf9f60'; 

        // (ВЕСЬ КОД СЛОВАРЕЙ LANGDATA, DADATA И ФУНКЦИЙ ОСТАЕТСЯ БЕЗ ИЗМЕНЕНИЙ)
        // КРОМЕ ОДНОГО МОМЕНТА - ПРОФИЛЬ

        // --- REAL PROFILE LOGIC (FIXED) ---
        if(tg.initDataUnsafe?.user) {
            const u = tg.initDataUnsafe.user;
            const fullName = `${u.first_name} ${u.last_name || ''}`.trim();
            document.getElementById('u-name').innerText = fullName;
            if(u.username) document.getElementById('u-username').innerText = '@' + u.username;
            
            const avaBox = document.getElementById('u-ava');
            if(u.photo_url) {
                avaBox.innerHTML = `<img src="${u.photo_url}" style="width:100%;height:100%;object-fit:cover">`;
            } else {
                let initials = u.first_name[0];
                if(u.last_name) initials += u.last_name[0];
                avaBox.innerHTML = `<span style="font-size:24px; font-weight:700; color:var(--text-sec)">${initials.toUpperCase()}</span>`;
            }
        }

        // (ДАЛЕЕ ВЕСЬ ТВОЙ СТАРЫЙ JS КОД БЕЗ ИЗМЕНЕНИЙ, ТАК КАК ОН ТЕПЕРЬ БЕРЕТ db ИЗ catalog.js)
        // ... drawRealisticNobilis(), setupPTR(), etc ...
        
        // ВАЖНО: Удали старую строку `const db = [...]` внутри <script>, так как db теперь приходит извне!

        // ВЕСЬ ОСТАЛЬНОЙ КОД КОПИРУЙ ИЗ СТАРОЙ ВЕРСИИ site.html (ФУНКЦИИ render, buyNow и т.д.)
        // ОНИ ПОЛНОСТЬЮ СОВМЕСТИМЫ.
    </script>
    
    <!-- ДОБАВЬ ЭТОТ СКРИПТ В КОНЕЦ, ЧТОБЫ ЗАПУСТИТЬ ЛОГИКУ ПОСЛЕ ЗАГРУЗКИ КАТАЛОГА -->
    <script>
        // Инициализация при старте (когда catalog.js загружен)
        window.addEventListener('load', () => {
             drawRealisticNobilis();
             render(db); // db берется из файла catalog.js
             updateCartQuantities();
        });
    </script>
</body>
</html>
