<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flower Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #fff);
            --text-color: var(--tg-theme-text-color, #000);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f5f5f5);
            --accent-color: #e91e63; /* –†–æ–∑–æ–≤—ã–π –¥–ª—è —Ü–≤–µ—Ç–æ–≤ */
            --button-text: #fff;
            --hint-color: #888;
            --nav-height: 60px;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0;
            padding-bottom: calc(var(--nav-height) + 20px);
            -webkit-tap-highlight-color: transparent;
        }

        /* --- –®–ê–ü–ö–ê --- */
        header {
            position: sticky; top: 0; z-index: 50;
            background: var(--bg-color);
            padding: 10px 15px;
            display: flex; align-items: center; gap: 10px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .logo { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }
        .brand-name { font-weight: 700; font-size: 18px; }

        /* --- –°–¢–†–ê–ù–ò–¶–´ --- */
        .page { display: none; padding: 15px; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- –°–ï–¢–ö–ê –¢–û–í–ê–†–û–í --- */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        /* –ö–ê–†–¢–û–ß–ö–ê –¢–û–í–ê–†–ê */
        .card {
            background: var(--secondary-bg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        /* –°–õ–ê–ô–î–ï–† –§–û–¢–û (–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª) */
        .slider-wrapper {
            position: relative;
            width: 100%;
            height: 150px; /* –í—ã—Å–æ—Ç–∞ —Ñ–æ—Ç–æ –≤ —Å–µ—Ç–∫–µ */
            overflow: hidden;
        }
        .slider {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            height: 100%;
            scrollbar-width: none; /* –°–∫—Ä—ã—Ç—å —Å–∫—Ä–æ–ª–ª–±–∞—Ä Firefox */
        }
        .slider::-webkit-scrollbar { display: none; } /* –°–∫—Ä—ã—Ç—å —Å–∫—Ä–æ–ª–ª–±–∞—Ä Chrome */
        
        .slide {
            min-width: 100%;
            height: 100%;
            scroll-snap-align: center;
        }
        .slide img {
            width: 100%; height: 100%; object-fit: cover;
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ñ–æ—Ç–æ (1/3) */
        .photo-count {
            position: absolute; bottom: 5px; right: 5px;
            background: rgba(0,0,0,0.5); color: white;
            font-size: 10px; padding: 2px 6px; border-radius: 10px;
            pointer-events: none;
        }

        .card-body { padding: 8px; text-align: center; }
        .card-title { font-weight: 600; font-size: 13px; margin-bottom: 4px; height: 32px; display: flex; align-items: center; justify-content: center; overflow: hidden;}
        .card-price { font-weight: 700; font-size: 14px; margin-bottom: 8px; color: var(--accent-color); }
        
        .btn {
            background: var(--accent-color); color: var(--button-text);
            border: none; border-radius: 8px; padding: 8px; width: 100%;
            font-size: 12px; font-weight: 600; cursor: pointer;
        }
        .btn-outline {
            background: transparent; border: 1px solid var(--accent-color); color: var(--accent-color);
            margin-top: 5px;
        }

        /* --- –ü–û–õ–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï (MODAL) --- */
        #product-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 200;
            overflow-y: auto;
            flex-direction: column;
        }
        .modal-header { position: absolute; top: 10px; right: 10px; z-index: 210; }
        .close-circle {
            background: rgba(0,0,0,0.5); color: white; width: 30px; height: 30px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 20px; cursor: pointer;
        }
        
        /* –ë–æ–ª—å—à–æ–π —Å–ª–∞–π–¥–µ—Ä –≤ –¥–µ—Ç–∞–ª—è—Ö */
        .detail-slider {
            width: 100%; height: 350px; /* –ë–æ–ª—å—à–æ–µ —Ñ–æ—Ç–æ */
            display: flex; overflow-x: auto; scroll-snap-type: x mandatory;
            scrollbar-width: none;
        }
        .detail-slide { min-width: 100%; height: 100%; scroll-snap-align: center; }
        .detail-slide img { width: 100%; height: 100%; object-fit: cover; }

        .detail-body { padding: 20px; }
        .detail-title { font-size: 22px; font-weight: 800; margin-bottom: 5px; }
        .detail-price { font-size: 20px; color: var(--accent-color); font-weight: 700; margin-bottom: 15px; }
        .detail-subtitle { font-size: 14px; color: var(--hint-color); text-transform: uppercase; margin-bottom: 5px; font-weight: bold; }
        .detail-text { font-size: 15px; line-height: 1.5; margin-bottom: 20px; }
        
        .sticky-btn-container {
            position: sticky; bottom: 20px; padding: 0 20px;
        }
        .btn-big { padding: 15px; font-size: 16px; box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3); }


        /* --- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ --- */
        .tab-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height);
            background: var(--bg-color); border-top: 1px solid rgba(0,0,0,0.05);
            display: flex; justify-content: space-around; align-items: center; z-index: 100;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .tab-btn {
            background: none; border: none; color: var(--hint-color);
            display: flex; flex-direction: column; align-items: center; font-size: 10px; font-weight: 500;
        }
        .tab-btn.active { color: var(--accent-color); }
        .tab-icon { font-size: 20px; margin-bottom: 3px; }
        .badge {
            position: absolute; top: 5px; margin-left: 15px;
            background: red; color: white; font-size: 10px; padding: 2px 5px; border-radius: 10px; display: none;
        }

        /* --- –ö–û–†–ó–ò–ù–ê --- */
        .cart-item {
            display: flex; gap: 10px; background: var(--secondary-bg);
            padding: 10px; border-radius: 10px; margin-bottom: 10px;
        }
        .cart-img { width: 50px; height: 50px; border-radius: 5px; object-fit: cover; }
        .cart-info { flex-grow: 1; }
        .cart-remove { color: red; font-weight: bold; padding: 5px; cursor: pointer; }

    </style>
</head>
<body>

    <!-- –®–ê–ü–ö–ê -->
    <header>
        <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –ª–æ–≥–æ (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ—é) -->
        <img src="https://cdn-icons-png.flaticon.com/512/3063/3063822.png" class="logo">
        <div class="brand-name">Flowers Boutique</div>
    </header>

    <!-- 1. –ö–ê–¢–ê–õ–û–ì -->
    <div id="page-catalog" class="page active">
        <div class="grid" id="products-container"></div>
    </div>

    <!-- 2. –ö–û–†–ó–ò–ù–ê -->
    <div id="page-cart" class="page">
        <h2>–ú–æ—è –∫–æ—Ä–∑–∏–Ω–∞</h2>
        <div id="cart-list">–ü—É—Å—Ç–æ</div>
        <div style="text-align: right; font-size: 18px; font-weight: bold; margin-top: 20px;">
            –ò—Ç–æ–≥–æ: <span id="cart-total">0</span> ‚ÇΩ
        </div>
        <button class="btn btn-big" style="margin-top: 20px;" onclick="checkout()">–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó</button>
    </div>

    <!-- 3. –ü–†–û–§–ò–õ–¨ -->
    <div id="page-profile" class="page">
        <div style="background: var(--secondary-bg); padding: 20px; border-radius: 15px; text-align: center;">
            <div style="width: 80px; height: 80px; background: #ddd; border-radius: 50%; margin: 0 auto 10px;" id="user-ava"></div>
            <h2 id="user-name">–ì–æ—Å—Ç—å</h2>
        </div>
        <div style="margin-top: 20px; padding: 10px;">
            <p>üå∏ –í–∞—à–∏ –±–∞–ª–ª—ã: 0</p>
            <p>üì¶ –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã: –Ω–µ—Ç</p>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û (–î–ï–¢–ê–õ–ò –¢–û–í–ê–†–ê) -->
    <div id="product-modal">
        <div class="modal-header">
            <div class="close-circle" onclick="closeModal()">√ó</div>
        </div>
        <!-- –°–ª–∞–π–¥–µ—Ä –≤ –¥–µ—Ç–∞–ª—è—Ö -->
        <div class="detail-slider" id="modal-slider"></div>
        
        <div class="detail-body">
            <div class="detail-title" id="modal-title"></div>
            <div class="detail-price" id="modal-price"></div>
            
            <div class="detail-subtitle">–°–æ—Å—Ç–∞–≤</div>
            <div class="detail-text" id="modal-comp"></div>

            <div class="detail-subtitle">–û–ø–∏—Å–∞–Ω–∏–µ</div>
            <div class="detail-text" id="modal-desc"></div>
        </div>
        
        <div class="sticky-btn-container">
            <button class="btn btn-big" id="modal-add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
        </div>
    </div>

    <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ -->
    <nav class="tab-bar">
        <button class="tab-btn active" onclick="openTab('catalog', this)">
            <div class="tab-icon">üå∫</div>–ö–∞—Ç–∞–ª–æ–≥
        </button>
        <button class="tab-btn" style="position: relative;" onclick="openTab('cart', this)">
            <span class="badge" id="cart-badge">0</span>
            <div class="tab-icon">üõí</div>–ö–æ—Ä–∑–∏–Ω–∞
        </button>
        <button class="tab-btn" onclick="openTab('profile', this)">
            <div class="tab-icon">üë§</div>–ü—Ä–æ—Ñ–∏–ª—å
        </button>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –ë–ê–ó–ê –¶–í–ï–¢–û–í (–§–û–¢–û - –°—Å—ã–ª–∫–∏ –Ω–∞ Unsplash –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞) ---
        // –ó–∞–º–µ–Ω–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–≤–æ–∏!
        const products = [
            {
                id: 1, 
                name: "–ë—É–∫–µ—Ç '–ù–µ–∂–Ω–æ—Å—Ç—å'", 
                price: 3500, 
                desc: "–ò–¥–µ–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è —Å–≤–∏–¥–∞–Ω–∏—è. –û—á–µ–Ω—å –∞—Ä–æ–º–∞—Ç–Ω—ã–µ –∏ —Å—Ç–æ–π–∫–∏–µ.",
                composition: "–†–æ–∑—ã —Ä–æ–∑–æ–≤—ã–µ (7 —à—Ç), –≠–≤–∫–∞–ª–∏–ø—Ç, –£–ø–∞–∫–æ–≤–∫–∞ –∫—Ä–∞—Ñ—Ç, –õ–µ–Ω—Ç–∞ –∞—Ç–ª–∞—Å–Ω–∞—è.",
                images: [
                    "https://images.unsplash.com/photo-1587575494201-11fe74d90d38?w=400",
                    "https://images.unsplash.com/photo-1562690868-60bbe7293e94?w=400",
                    "https://images.unsplash.com/photo-1494959764136-6be9eb3c261e?w=400"
                ]
            },
            {
                id: 2, 
                name: "101 –ö—Ä–∞—Å–Ω–∞—è –†–æ–∑–∞", 
                price: 15000, 
                desc: "–ö–ª–∞—Å—Å–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–æ—Ä–∏—Ç –ª—é–±–æ–µ —Å–µ—Ä–¥—Ü–µ. –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–±–ª—è 60 —Å–º.",
                composition: "–†–æ–∑—ã –∫—Ä–∞—Å–Ω—ã–µ (101 —à—Ç), –õ–µ–Ω—Ç–∞.",
                images: [
                    "https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=400", 
                    "https://images.unsplash.com/photo-1559563362-c667ba5f5480?w=400",
                    "https://images.unsplash.com/photo-1533616688419-b7a585564566?w=400"
                ]
            },
            {
                id: 3, 
                name: "–¢—é–ª—å–ø–∞–Ω—ã –ú–∏–∫—Å", 
                price: 2500, 
                desc: "–í–µ—Å–µ–Ω–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤ –ª—é–±—É—é –ø–æ–≥–æ–¥—É. –Ø—Ä–∫–∏–µ –∏ —Å–≤–µ–∂–∏–µ.",
                composition: "–¢—é–ª—å–ø–∞–Ω—ã —Ä–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω—ã–µ (15 —à—Ç), –£–ø–∞–∫–æ–≤–∫–∞.",
                images: [
                    "https://images.unsplash.com/photo-1520763185298-1b434c919102?w=400",
                    "https://images.unsplash.com/photo-1586944686443-bd287c4d5d4b?w=400",
                    "https://images.unsplash.com/photo-1457089328109-e5d9bd499191?w=400"
                ]
            },
            {
                id: 4, 
                name: "–ü–∏–æ–Ω—ã (–°–µ–∑–æ–Ω)", 
                price: 4500, 
                desc: "–°–∞–º—ã–µ –∂–µ–ª–∞–Ω–Ω—ã–µ —Ü–≤–µ—Ç—ã. –ö—Ä—É–ø–Ω—ã–µ –±—É—Ç–æ–Ω—ã —Å–æ—Ä—Ç–∞ –°–∞—Ä–∞ –ë–µ—Ä–Ω–∞—Ä.",
                composition: "–ü–∏–æ–Ω—ã —Ä–æ–∑–æ–≤—ã–µ (5 —à—Ç), –ó–µ–ª–µ–Ω—å.",
                images: [
                    "https://images.unsplash.com/photo-1563241527-300027e99740?w=400",
                    "https://images.unsplash.com/photo-1554631221-f9603e6808be?w=400",
                    "https://images.unsplash.com/photo-1462275646964-a0e3386b89fa?w=400"
                ]
            },
            {
                id: 5, 
                name: "–ë—É–∫–µ—Ç –≤ –∫–æ—Ä–æ–±–∫–µ", 
                price: 5000, 
                desc: "–°—Ç–∏–ª—å–Ω–∞—è —à–ª—è–ø–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞. –ù–µ –Ω—É–∂–Ω–∞ –≤–∞–∑–∞, –≤–Ω—É—Ç—Ä–∏ –≥—É–±–∫–∞ —Å –≤–æ–¥–æ–π.",
                composition: "–ì–æ—Ä—Ç–µ–Ω–∑–∏—è, –†–æ–∑—ã, –≠—É—Å—Ç–æ–º–∞, –®–ª—è–ø–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞.",
                images: [
                    "https://images.unsplash.com/photo-1585220177021-d107293ebc56?w=400",
                    "https://images.unsplash.com/photo-1561181286-d3fee7d55364?w=400",
                    "https://images.unsplash.com/photo-1596627685698-c92c55b62e4c?w=400"
                ]
            },
            {
                id: 6, 
                name: "–°—É—Ö–æ—Ü–≤–µ—Ç—ã –õ–∞–≤–∞–Ω–¥–∞", 
                price: 1500, 
                desc: "–ê—Ä–æ–º–∞—Ç–Ω–∞—è –ª–∞–≤–∞–Ω–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Ä–∞–¥–æ–≤–∞—Ç—å –≥–æ–¥–∞–º–∏.",
                composition: "–õ–∞–≤–∞–Ω–¥–∞ –∫—Ä—ã–º—Å–∫–∞—è, –ö—Ä–∞—Ñ—Ç.",
                images: [
                    "https://images.unsplash.com/photo-1498757581981-8ddb3c0b9b07?w=400",
                    "https://images.unsplash.com/photo-1595123550441-d377e017de6a?w=400",
                    "https://images.unsplash.com/photo-1533038590840-1cde6b468956?w=400"
                ]
            }
        ];

        let cart = [];

        // --- –ì–ï–ù–ï–†–ê–¶–ò–Ø –ö–ê–¢–ê–õ–û–ì–ê ---
        function renderCatalog() {
            const container = document.getElementById('products-container');
            container.innerHTML = '';
            
            products.forEach(p => {
                // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ (3 –∫–∞—Ä—Ç–∏–Ω–∫–∏)
                let slidesHtml = '';
                p.images.forEach(imgUrl => {
                    slidesHtml += `<div class="slide"><img src="${imgUrl}" loading="lazy"></div>`;
                });

                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <div class="slider-wrapper">
                        <div class="slider">${slidesHtml}</div>
                        <div class="photo-count">–õ–∏—Å—Ç–∞–π ‚Æï</div>
                    </div>
                    <div class="card-body">
                        <div class="card-title" onclick="openModal(${p.id})">${p.name}</div>
                        <div class="card-price">${p.price} ‚ÇΩ</div>
                        <button class="btn" onclick="addToCart(${p.id})">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                        <button class="btn btn-outline" onclick="openModal(${p.id})">–°–æ—Å—Ç–∞–≤</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // --- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û (–î–ï–¢–ê–õ–ò) ---
        function openModal(id) {
            const p = products.find(i => i.id === id);
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –±–æ–ª—å—à–æ–π —Å–ª–∞–π–¥–µ—Ä
            const slider = document.getElementById('modal-slider');
            slider.innerHTML = '';
            p.images.forEach(img => {
                slider.innerHTML += `<div class="detail-slide"><img src="${img}"></div>`;
            });

            document.getElementById('modal-title').innerText = p.name;
            document.getElementById('modal-price').innerText = p.price + ' ‚ÇΩ';
            document.getElementById('modal-comp').innerText = p.composition;
            document.getElementById('modal-desc').innerText = p.desc;
            
            // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            const btn = document.getElementById('modal-add-btn');
            btn.onclick = function() {
                addToCart(p.id);
                closeModal();
            };

            document.getElementById('product-modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('product-modal').style.display = 'none';
        }

        // --- –ö–û–†–ó–ò–ù–ê –ò –¢–ê–ë–´ ---
        function addToCart(id) {
            const item = products.find(i => i.id === id);
            cart.push(item);
            tg.HapticFeedback.impactOccurred('light');
            updateBadge();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            tg.showPopup({
                title: '–ü—Ä–µ–∫—Ä–∞—Å–Ω—ã–π –≤—ã–±–æ—Ä!',
                message: `${item.name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É.`,
                buttons: [{type: 'ok'}]
            });
        }

        function updateBadge() {
            const badge = document.getElementById('cart-badge');
            if (cart.length > 0) {
                badge.style.display = 'block';
                badge.innerText = cart.length;
            } else {
                badge.style.display = 'none';
            }
        }

        function renderCart() {
            const list = document.getElementById('cart-list');
            list.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                list.innerHTML = '<div style="text-align:center; margin-top:30px; color:#888;">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞ üå∏</div>';
            } else {
                cart.forEach((item, idx) => {
                    total += item.price;
                    const div = document.createElement('div');
                    div.className = 'cart-item';
                    div.innerHTML = `
                        <img src="${item.images[0]}" class="cart-img">
                        <div class="cart-info">
                            <div style="font-weight:600">${item.name}</div>
                            <div style="font-size:13px; color:#888;">${item.price} ‚ÇΩ</div>
                        </div>
                        <div class="cart-remove" onclick="removeFromCart(${idx})">–£–¥–∞–ª–∏—Ç—å</div>
                    `;
                    list.appendChild(div);
                });
            }
            document.getElementById('cart-total').innerText = total;
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            renderCart();
            updateBadge();
        }

        function openTab(name, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + name).classList.add('active');
            
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            if (name === 'cart') renderCart();
        }

        function checkout() {
            if (cart.length === 0) return;
            const total = cart.reduce((acc, i) => acc + i.price, 0);
            tg.sendData(JSON.stringify({ total: total, items: cart.map(i => i.name) }));
        }

        // --- –°–¢–ê–†–¢ ---
        renderCatalog();
        
        // –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ–º –∏–º—è —é–∑–µ—Ä–∞
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            document.getElementById('user-name').innerText = tg.initDataUnsafe.user.first_name;
        }

    </script>
</body>
</html>
