<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flower Shop Ultimate</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò --- */
#preloader {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: var(--bg-color);
    z-index: 9999; /* –°–∞–º—ã–π –≤–µ—Ä—Ö–Ω–∏–π —Å–ª–æ–π */
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    transition: opacity 0.5s;
}
.loader-spinner {
    width: 50px; height: 50px;
    border: 5px solid #f3f3f3;
    border-top: 5px solid var(--accent-color); /* –†–æ–∑–æ–≤—ã–π */
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        :root {
            --bg-color: var(--tg-theme-bg-color, #fff);
            --text-color: var(--tg-theme-text-color, #000);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f5f5f5);
            --accent-color: #e91e63; /* –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç (–†–æ–∑–æ–≤—ã–π) */
            --fav-color: #ff3b30;     /* –¶–≤–µ—Ç —Å–µ—Ä–¥–µ—á–∫–∞ */
            --nav-height: 60px;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0;
            padding-bottom: calc(var(--nav-height) + 20px);
            -webkit-tap-highlight-color: transparent;
        }

        /* --- –®–ê–ü–ö–ê --- */
        header {
            position: sticky; top: 0; z-index: 50;
            background: var(--bg-color);
            padding: 10px 15px;
            display: flex; align-items: center; gap: 10px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .logo { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }
        .brand-name { font-weight: 700; font-size: 18px; }

        /* --- –°–¢–†–ê–ù–ò–¶–´ --- */
        .page { display: none; padding: 15px; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- –ü–û–ò–°–ö --- */
        .search-bar {
            width: 100%; padding: 12px; border-radius: 12px;
            border: 1px solid #ddd; background: var(--secondary-bg);
            color: var(--text-color); font-size: 16px; outline: none;
            margin-bottom: 20px; box-sizing: border-box;
        }
        .search-bar:focus { border-color: var(--accent-color); }

        /* --- –°–ï–¢–ö–ê –¢–û–í–ê–†–û–í --- */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        
        .card {
            background: var(--secondary-bg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            padding-bottom: 10px;
        }

        /* –ò–ö–û–ù–ö–ê –ò–ó–ë–†–ê–ù–ù–û–ì–û (–°–ï–†–î–¶–ï) */
        .fav-icon-overlay {
            position: absolute; top: 8px; right: 8px;
            width: 30px; height: 30px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px; z-index: 20; cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .fav-icon-overlay.active { color: var(--fav-color); }
        .fav-icon-overlay:not(.active) { color: #ccc; }

        /* –°–õ–ê–ô–î–ï–† –§–û–¢–û */
        .slider-wrapper { position: relative; width: 100%; height: 160px; overflow: hidden; }
        .slider { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; height: 100%; scrollbar-width: none; }
        .slider::-webkit-scrollbar { display: none; }
        .slide { min-width: 100%; height: 100%; scroll-snap-align: center; }
        .slide img { width: 100%; height: 100%; object-fit: cover; }
        
        /* –ö–ê–†–¢–û–ß–ö–ê –ò–ù–§–û */
        .card-body { padding: 8px; position: relative; }
        .card-title { font-weight: 600; font-size: 13px; margin-bottom: 4px; line-height: 1.2; height: 32px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;}
        .card-price { font-weight: 700; font-size: 15px; color: var(--text-color); }
        
        /* –ö–†–£–ì–õ–ê–Ø –ö–ù–û–ü–ö–ê –ö–û–†–ó–ò–ù–´ */
        .btn-cart-circle {
            position: absolute;
            bottom: 8px; right: 8px;
            width: 36px; height: 36px;
            background: var(--accent-color);
            color: white;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px;
            box-shadow: 0 4px 10px rgba(233, 30, 99, 0.3);
            cursor: pointer;
            z-index: 10;
        }
        .btn-cart-circle:active { transform: scale(0.9); }

        /* --- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ --- */
        .tab-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height);
            background: var(--bg-color); border-top: 1px solid rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center; z-index: 100;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .tab-btn {
            background: none; border: none; color: #aaa;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 9px; font-weight: 500; width: 20%;
        }
        .tab-btn.active { color: var(--accent-color); }
        .tab-icon { font-size: 22px; margin-bottom: 2px; }
        .badge {
            position: absolute; top: 2px; margin-left: 14px;
            background: red; color: white; font-size: 9px; padding: 2px 5px; border-radius: 10px; display: none;
        }

        /* --- –ö–û–†–ó–ò–ù–ê --- */
        .list-item { display: flex; gap: 10px; background: var(--secondary-bg); padding: 10px; border-radius: 10px; margin-bottom: 10px; position: relative; }
        .list-img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; }
        .list-info { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; }
        .list-remove { position: absolute; top: 10px; right: 10px; color: #ff3b30; font-size: 20px; cursor: pointer; }

        /* --- –ü–†–û–§–ò–õ–¨ --- */
        .profile-header { background: var(--secondary-bg); padding: 30px 20px; border-radius: 20px; text-align: center; margin-bottom: 20px;}
        .profile-img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; border: 3px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .profile-name { font-size: 20px; font-weight: 800; }
        
        /* --- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û --- */
        #product-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 200; overflow-y: auto; flex-direction: column; }
        .close-circle { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.5); color: white; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; z-index: 210; }
        .detail-slider { width: 100%; height: 380px; display: flex; overflow-x: auto; scroll-snap-type: x mandatory; }
        .detail-slide { min-width: 100%; height: 100%; scroll-snap-align: center; }
        .detail-slide img { width: 100%; height: 100%; object-fit: cover; }
        .detail-body { padding: 20px; padding-bottom: 80px; }
        .detail-title { font-size: 24px; font-weight: 800; margin-bottom: 5px;}
        .detail-price { font-size: 22px; color: var(--accent-color); font-weight: 700; margin-bottom: 20px; }
        
        .sticky-btn { position: sticky; bottom: 20px; padding: 0 20px; display: flex; gap: 10px; }
        .btn-big { flex-grow: 1; padding: 15px; font-size: 16px; background: var(--accent-color); color: white; border: none; border-radius: 12px; font-weight: bold; box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3); }
        .btn-share { width: 50px; background: var(--secondary-bg); color: var(--text-color); border-radius: 12px; border: none; font-size: 20px; display: flex; align-items: center; justify-content: center; }

    </style>
</head>
<body>
    <!-- –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò -->
    <div id="preloader">
        <div class="loader-spinner"></div>
        <div style="font-weight: bold; color: #888;">–ó–∞–≥—Ä—É–∂–∞–µ–º –∫—Ä–∞—Å–æ—Ç—É...</div>
    </div>
    
    <!-- –î–∞–ª—å—à–µ –∏–¥–µ—Ç —Ç–≤–æ–π header, —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Ç.–¥. -->
    

    <header>
        <img src="https://cdn-icons-png.flaticon.com/512/3063/3063822.png" class="logo">
        <div class="brand-name">Flower Boutique</div>
    </header>

    <!-- 1. –ö–ê–¢–ê–õ–û–ì -->
    <div id="page-catalog" class="page active">
        <div class="grid" id="products-container"></div>
    </div>

    <!-- 2. –ü–û–ò–°–ö (–í–ú–ï–°–¢–û –ò–°–¢–û–†–ò–ò) -->
    <div id="page-search" class="page">
        <h2>–ü–æ–∏—Å–∫ —Ü–≤–µ—Ç–æ–≤ üîç</h2>
        <input type="text" class="search-bar" id="search-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∫–∞..." oninput="searchProducts()">
        <div class="grid" id="search-results"></div>
        <p id="search-empty" style="color: #888; text-align: center; display: none;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
    </div>

    <!-- 3. –ö–û–†–ó–ò–ù–ê -->
    <div id="page-cart" class="page">
        <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
        <div id="cart-list">–ü—É—Å—Ç–æ</div>
        <div style="text-align: right; font-size: 18px; font-weight: bold; margin-top: 20px;">
            –ò—Ç–æ–≥–æ: <span id="cart-total">0</span> ‚ÇΩ
        </div>
        <button class="btn-big" style="width: 100%; margin-top: 20px;" onclick="checkout()">–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó</button>
    </div>

    <!-- 4. –ò–ó–ë–†–ê–ù–ù–û–ï -->
    <div id="page-fav" class="page">
        <h2>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ ‚ù§Ô∏è</h2>
        <div class="grid" id="fav-container"></div>
        <p id="fav-empty" style="color: #888; display:none">–ó–¥–µ—Å—å –±—É–¥—É—Ç –≤–∞—à–∏ –ª—é–±–∏–º—ã–µ —Ü–≤–µ—Ç—ã.</p>
    </div>

    <!-- 5. –ü–†–û–§–ò–õ–¨ -->
    <div id="page-profile" class="page">
        <div class="profile-header">
            <!-- –§–û–¢–û –ò–ó –¢–ì -->
            <img src="" id="user-ava" class="profile-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/847/847969.png'">
            <div class="profile-name" id="user-name">–ì–æ—Å—Ç—å</div>
            <div style="color: #888; font-size: 14px; margin-top: 5px;">–õ—é–±–∏—Ç–µ–ª—å —Ü–≤–µ—Ç–æ–≤</div>
        </div>
        
        <div style="background: var(--secondary-bg); padding: 15px; border-radius: 12px; margin-bottom: 10px;">
            üì¶ <b>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</b> <span style="float: right;">></span>
        </div>
        <div style="background: var(--secondary-bg); padding: 15px; border-radius: 12px; margin-bottom: 10px;">
            üí¨ <b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</b> <span style="float: right;">></span>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û (–î–ï–¢–ê–õ–ò) -->
    <div id="product-modal">
        <div class="close-circle" onclick="closeModal()">√ó</div>
        <div class="detail-slider" id="modal-slider"></div>
        <div class="detail-body">
            <div class="detail-title" id="modal-title"></div>
            <div class="detail-price" id="modal-price"></div>
            
            <h3 style="margin-bottom: 5px;">–°–æ—Å—Ç–∞–≤</h3>
            <p id="modal-comp" style="margin-bottom: 15px; color: #555;"></p>
            
            <h3 style="margin-bottom: 5px;">–û–ø–∏—Å–∞–Ω–∏–µ</h3>
            <p id="modal-desc" style="color: #555; line-height: 1.5;"></p>
        </div>
        <div class="sticky-btn">
            <button class="btn-share" onclick="shareProduct()">üì§</button>
            <button class="btn-big" id="modal-add-btn">–í –∫–æ—Ä–∑–∏–Ω—É</button>
        </div>
    </div>

    <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ -->
    <nav class="tab-bar">
        <button class="tab-btn active" onclick="openTab('catalog', this)">
            <div class="tab-icon">üå∫</div>–ö–∞—Ç–∞–ª–æ–≥
        </button>
        <button class="tab-btn" onclick="openTab('search', this)">
            <div class="tab-icon">üîç</div>–ü–æ–∏—Å–∫
        </button>
        <button class="tab-btn" style="position: relative;" onclick="openTab('cart', this)">
            <span class="badge" id="cart-badge">0</span>
            <div class="tab-icon">üõí</div>–ö–æ—Ä–∑–∏–Ω–∞
        </button>
        <button class="tab-btn" onclick="openTab('fav', this)">
            <div class="tab-icon">‚ù§Ô∏è</div>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ
        </button>
        <button class="tab-btn" onclick="openTab('profile', this)">
            <div class="tab-icon">üë§</div>–ü—Ä–æ—Ñ–∏–ª—å
        </button>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –ë–ê–ó–ê –î–ê–ù–ù–´–• ---
        const products = [
            { id: 1, name: "–ë—É–∫–µ—Ç '–ù–µ–∂–Ω–æ—Å—Ç—å'", price: 3500, comp: "–†–æ–∑—ã, –≠–≤–∫–∞–ª–∏–ø—Ç", desc: "–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –±—É–∫–µ—Ç –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Å–≤–∏–¥–∞–Ω–∏—è.", images: ["https://images.unsplash.com/photo-1587575494201-11fe74d90d38?w=400", "https://images.unsplash.com/photo-1562690868-60bbe7293e94?w=400"] },
            { id: 2, name: "101 –ö—Ä–∞—Å–Ω–∞—è –†–æ–∑–∞", price: 15000, comp: "–†–æ–∑—ã –ì—Ä–∞–Ω –ü—Ä–∏ (60—Å–º)", desc: "–ö–ª–∞—Å—Å–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞—Å—Ç–æ–ø–∏—Ç –ª—é–±–æ–µ —Å–µ—Ä–¥—Ü–µ.", images: ["https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=400", "https://images.unsplash.com/photo-1559563362-c667ba5f5480?w=400"] },
            { id: 3, name: "–¢—é–ª—å–ø–∞–Ω—ã –ú–∏–∫—Å", price: 2500, comp: "15 —Ç—é–ª—å–ø–∞–Ω–æ–≤", desc: "–Ø—Ä–∫–∏–µ –≤–µ—Å–µ–Ω–Ω–∏–µ —Ü–≤–µ—Ç—ã —Ä–∞–∑–Ω—ã—Ö –æ—Ç—Ç–µ–Ω–∫–æ–≤.", images: ["https://images.unsplash.com/photo-1520763185298-1b434c919102?w=400", "https://images.unsplash.com/photo-1586944686443-bd287c4d5d4b?w=400"] },
            { id: 4, name: "–ü–∏–æ–Ω—ã –°–∞—Ä–∞ –ë–µ—Ä–Ω–∞—Ä", price: 4500, comp: "–ü–∏–æ–Ω—ã (5 —à—Ç)", desc: "–ö—Ä—É–ø–Ω—ã–µ –∞—Ä–æ–º–∞—Ç–Ω—ã–µ –±—É—Ç–æ–Ω—ã.", images: ["https://images.unsplash.com/photo-1563241527-300027e99740?w=400", "https://images.unsplash.com/photo-1554631221-f9603e6808be?w=400"] },
            { id: 5, name: "–®–ª—è–ø–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞", price: 5000, comp: "–ú–∏–∫—Å —Ü–≤–µ—Ç–æ–≤", desc: "–£–¥–æ–±–Ω–æ –∏ —Å—Ç–∏–ª—å–Ω–æ. –í–∞–∑–∞ –Ω–µ –Ω—É–∂–Ω–∞.", images: ["https://images.unsplash.com/photo-1585220177021-d107293ebc56?w=400", "https://images.unsplash.com/photo-1561181286-d3fee7d55364?w=400"] },
            { id: 6, name: "–õ–∞–≤–∞–Ω–¥–∞", price: 1500, comp: "–°—É—Ö–æ—Ü–≤–µ—Ç—ã", desc: "–ê—Ä–æ–º–∞—Ç –ü—Ä–æ–≤–∞–Ω—Å–∞ —É –≤–∞—Å –¥–æ–º–∞.", images: ["https://images.unsplash.com/photo-1498757581981-8ddb3c0b9b07?w=400", "https://images.unsplash.com/photo-1595123550441-d377e017de6a?w=400"] }
        ];

        // –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –ò–ó –ü–ê–ú–Ø–¢–ò
        let cart = JSON.parse(localStorage.getItem('cart_v1')) || [];
        let favorites = JSON.parse(localStorage.getItem('favs_v1')) || [];
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ (–¥–ª—è –∫–Ω–æ–ø–∫–∏ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è)
        let currentModalProduct = null;

        // --- –ì–ï–ù–ï–†–ê–¶–ò–Ø –ö–ê–†–¢–û–ß–ö–ò ---
        function createCardHTML(p) {
            let slides = '';
            p.images.forEach(img => slides += `<div class="slide"><img src="${img}"></div>`);

            const isFav = favorites.includes(p.id) ? 'active' : '';
            const heartIcon = isFav ? '‚ù§Ô∏è' : 'ü§ç';

            // –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ: –ö–ª–∏–∫ –ø–æ —Å–ª–∞–π–¥–µ—Ä—É (—Ñ–æ—Ç–æ) –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            // –ö–Ω–æ–ø–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã - —ç—Ç–æ –∫—Ä—É–∂–æ–∫ —Å–ø—Ä–∞–≤–∞ –≤–Ω–∏–∑—É
            return `
                <div class="card">
                    <div class="fav-icon-overlay ${isFav}" onclick="toggleFav(${p.id}, this, event)">${heartIcon}</div>
                    
                    <div class="slider-wrapper" onclick="openModal(${p.id})">
                        <div class="slider">${slides}</div>
                    </div>
                    
                    <div class="card-body">
                        <div class="card-title" onclick="openModal(${p.id})">${p.name}</div>
                        <div class="card-price">${p.price} ‚ÇΩ</div>
                    </div>

                    <div class="btn-cart-circle" onclick="addToCart(${p.id}, event)">üõí</div>
                </div>
            `;
        }

        function renderGrid(items, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            items.forEach(p => {
                const div = document.createElement('div');
                div.innerHTML = createCardHTML(p);
                container.appendChild(div.firstElementChild); // –í—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π div
            });
        }

        // --- –ü–û–ò–°–ö ---
        function searchProducts() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const found = products.filter(p => p.name.toLowerCase().includes(query));
            
            renderGrid(found, 'search-results');
            
            document.getElementById('search-empty').style.display = found.length === 0 ? 'block' : 'none';
        }

        // --- –ö–û–†–ó–ò–ù–ê –° –°–û–•–†–ê–ù–ï–ù–ò–ï–ú ---
        function addToCart(id, event) {
            if(event) event.stopPropagation(); // –ß—Ç–æ–±—ã –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è –º–æ–¥–∞–ª
            
            const item = products.find(p => p.id === id);
            cart.push(item);
            saveData(); // –°–û–•–†–ê–ù–Ø–ï–ú!
            
            tg.HapticFeedback.impactOccurred('light');
            updateBadge();
            
            tg.showPopup({ title: '–î–æ–±–∞–≤–ª–µ–Ω–æ', message: '–¢–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω–µ üõí', buttons: [{type: 'ok'}] });
        }

        function saveData() {
            localStorage.setItem('cart_v1', JSON.stringify(cart));
            localStorage.setItem('favs_v1', JSON.stringify(favorites));
        }

        function updateBadge() {
            const badge = document.getElementById('cart-badge');
            badge.style.display = cart.length > 0 ? 'block' : 'none';
            badge.innerText = cart.length;
        }

        function renderCart() {
            const list = document.getElementById('cart-list');
            list.innerHTML = '';
            let total = 0;
            if(cart.length === 0) {
                list.innerHTML = '<p style="text-align:center; margin-top:30px; color:#888">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞ üõí</p>';
            } else {
                cart.forEach((item, idx) => {
                    total += item.price;
                    list.innerHTML += `
                        <div class="list-item">
                            <img src="${item.images[0]}" class="list-img">
                            <div class="list-info"><b>${item.name}</b><br>${item.price} ‚ÇΩ</div>
                            <div class="list-remove" onclick="removeCart(${idx})">√ó</div>
                        </div>`;
                });
            }
            document.getElementById('cart-total').innerText = total;
        }

        function removeCart(idx) { 
            cart.splice(idx, 1); 
            saveData(); // –°–û–•–†–ê–ù–Ø–ï–ú –ü–û–°–õ–ï –£–î–ê–õ–ï–ù–ò–Ø
            renderCart(); 
            updateBadge(); 
        }

        // --- –ò–ó–ë–†–ê–ù–ù–û–ï ---
        function toggleFav(id, btn, event) {
            event.stopPropagation();
            const index = favorites.indexOf(id);
            if (index === -1) {
                favorites.push(id);
                btn.classList.add('active'); btn.innerText = '‚ù§Ô∏è';
                tg.HapticFeedback.impactOccurred('medium');
            } else {
                favorites.splice(index, 1);
                btn.classList.remove('active'); btn.innerText = 'ü§ç';
                tg.HapticFeedback.impactOccurred('light');
            }
            saveData();
            if(document.getElementById('page-fav').classList.contains('active')) renderFavPage();
        }

        function renderFavPage() {
            const container = document.getElementById('fav-container');
            container.innerHTML = '';
            const favItems = products.filter(p => favorites.includes(p.id));
            
            if(favItems.length === 0) {
                document.getElementById('fav-empty').style.display = 'block';
            } else {
                document.getElementById('fav-empty').style.display = 'none';
                renderGrid(favItems, 'fav-container');
            }
        }

        // --- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û ---
        function openModal(id) {
            const p = products.find(i => i.id === id);
            currentModalProduct = p; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –¥–ª—è Share

            let slides = '';
            p.images.forEach(img => slides += `<div class="detail-slide"><img src="${img}"></div>`);
            
            document.getElementById('modal-slider').innerHTML = slides;
            document.getElementById('modal-title').innerText = p.name;
            document.getElementById('modal-price').innerText = p.price + ' ‚ÇΩ';
            document.getElementById('modal-comp').innerText = p.comp;
            document.getElementById('modal-desc').innerText = p.desc;
            
            document.getElementById('modal-add-btn').onclick = () => { addToCart(id); closeModal(); };
            
            document.getElementById('product-modal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('product-modal').style.display = 'none'; }

        // --- –ü–û–î–ï–õ–ò–¢–¨–°–Ø ---
        function shareProduct() {
            if(!currentModalProduct) return;
            const text = `–°–º–æ—Ç—Ä–∏, –∫–∞–∫–æ–π –±—É–∫–µ—Ç: ${currentModalProduct.name} –∑–∞ ${currentModalProduct.price}‚ÇΩ! üå∏`;
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Ç–∏–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é Telegram –¥–ª—è —à–µ—Ä–∏–Ω–≥–∞ —Ç–µ–∫—Å—Ç–∞
            tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(text)}`);
        }

        // --- –ü–†–û–§–ò–õ–¨ ---
        function loadProfile() {
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                const fullName = `${user.first_name} ${user.last_name || ''}`.trim();
                
                document.getElementById('user-name').innerText = fullName;
                
                if (user.photo_url) {
                    document.getElementById('user-ava').src = user.photo_url;
                }
            }
        }

        // --- –ù–ê–í–ò–ì–ê–¶–ò–Ø ---
        function openTab(name, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + name).classList.add('active');
            
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            if(name === 'cart') renderCart();
            if(name === 'fav') renderFavPage();
            if(name === 'search') document.getElementById('search-input').focus();
        }

        function checkout() {
            if(cart.length === 0) return;
            const total = cart.reduce((a, b) => a + b.price, 0);
            tg.sendData(JSON.stringify({ total: total, items: cart.map(i => i.name) }));
        }

        // –°–¢–ê–†–¢
        renderGrid(products, 'products-container');
        updateBadge();
        loadProfile();

         // üëáüëáüëá –í–°–¢–ê–í–õ–Ø–ô –ö–û–î –ù–ò–ñ–ï, –í–û–¢ –°–Æ–î–ê üëáüëáüëá

        window.onload = function() {
            setTimeout(() => {
                const preloader = document.getElementById('preloader');
                // –î–µ–ª–∞–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º
                if(preloader) {
                    preloader.style.opacity = '0';
                    // –ß–µ—Ä–µ–∑ –ø–æ–ª—Å–µ–∫—É–Ω–¥—ã —É–¥–∞–ª—è–µ–º —Å–æ–≤—Å–µ–º
                    setTimeout(() => {
                        preloader.style.display = 'none';
                    }, 500);
                }
            }, 500);
        };

        // üëÜüëÜüëÜ –ö–û–ù–ï–¶ –í–°–¢–ê–í–ö–ò üëÜüëÜüëÜ

    </script>
</body>
</html>
