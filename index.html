<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flower Deluxe</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #fff);
            --text-color: var(--tg-theme-text-color, #000);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f5f5f5);
            --accent-color: #e91e63; /* –†–æ–∑–æ–≤—ã–π */
            --fav-color: #ff3b30;     /* –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è —Å–µ—Ä–¥—Ü–∞ */
            --nav-height: 60px;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0;
            padding-bottom: calc(var(--nav-height) + 20px);
            -webkit-tap-highlight-color: transparent;
        }

        /* --- –®–ê–ü–ö–ê --- */
        header {
            position: sticky; top: 0; z-index: 50;
            background: var(--bg-color);
            padding: 10px 15px;
            display: flex; align-items: center; gap: 10px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .logo { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }
        .brand-name { font-weight: 700; font-size: 18px; }

        /* --- –°–ï–¢–ö–ê –¢–û–í–ê–†–û–í --- */
        .page { display: none; padding: 15px; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        .card {
            background: var(--secondary-bg);
            border-radius: 12px;
            overflow: hidden;
            position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ä–¥–µ—á–∫–∞ */
        }

        /* –ö–ù–û–ü–ö–ê –ò–ó–ë–†–ê–ù–ù–û–ì–û –ù–ê –§–û–¢–û */
        .fav-icon-overlay {
            position: absolute;
            top: 8px; right: 8px;
            width: 32px; height: 32px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px;
            z-index: 20; /* –ü–æ–≤–µ—Ä—Ö —Å–ª–∞–π–¥–µ—Ä–∞ */
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        .fav-icon-overlay:active { transform: scale(0.9); }
        .fav-icon-overlay.active { color: var(--fav-color); } /* –ö—Ä–∞—Å–Ω–æ–µ —Å–µ—Ä–¥—Ü–µ */
        .fav-icon-overlay:not(.active) { color: #ccc; }       /* –°–µ—Ä–æ–µ —Å–µ—Ä–¥—Ü–µ */

        /* –°–õ–ê–ô–î–ï–† */
        .slider-wrapper { position: relative; width: 100%; height: 160px; overflow: hidden; }
        .slider { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; height: 100%; scrollbar-width: none; }
        .slider::-webkit-scrollbar { display: none; }
        .slide { min-width: 100%; height: 100%; scroll-snap-align: center; }
        .slide img { width: 100%; height: 100%; object-fit: cover; }
        .photo-count {
            position: absolute; bottom: 5px; right: 5px;
            background: rgba(0,0,0,0.5); color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; pointer-events: none;
        }

        .card-body { padding: 8px; text-align: center; }
        .card-title { font-weight: 600; font-size: 13px; margin-bottom: 4px; height: 32px; display: flex; align-items: center; justify-content: center; }
        .card-price { font-weight: 700; font-size: 14px; margin-bottom: 8px; color: var(--accent-color); }
        
        .btn { background: var(--accent-color); color: white; border: none; border-radius: 8px; padding: 8px; width: 100%; font-size: 12px; font-weight: 600; cursor: pointer; }
        .btn-outline { background: transparent; border: 1px solid var(--accent-color); color: var(--accent-color); margin-top: 5px; }

        /* --- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ --- */
        .tab-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height);
            background: var(--bg-color); border-top: 1px solid rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; /* –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ */
            align-items: center; z-index: 100;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .tab-btn {
            background: none; border: none; color: #aaa;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 9px; font-weight: 500; width: 20%; /* 5 –∫–Ω–æ–ø–æ–∫ = 20% —à–∏—Ä–∏–Ω—ã –∫–∞–∂–¥–∞—è */
        }
        .tab-btn.active { color: var(--accent-color); }
        .tab-icon { font-size: 20px; margin-bottom: 3px; }
        .badge {
            position: absolute; top: 2px; margin-left: 12px;
            background: red; color: white; font-size: 9px; padding: 2px 5px; border-radius: 10px; display: none;
        }

        /* --- –ö–û–†–ó–ò–ù–ê –ò –ò–ó–ë–†–ê–ù–ù–û–ï --- */
        .list-item { display: flex; gap: 10px; background: var(--secondary-bg); padding: 10px; border-radius: 10px; margin-bottom: 10px; position: relative; }
        .list-img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; }
        .list-info { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; }
        .list-remove { position: absolute; top: 10px; right: 10px; color: #999; font-size: 18px; cursor: pointer; }

        /* --- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û --- */
        #product-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 200; overflow-y: auto; flex-direction: column; }
        .close-circle { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.5); color: white; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; z-index: 210; }
        .detail-slider { width: 100%; height: 350px; display: flex; overflow-x: auto; scroll-snap-type: x mandatory; }
        .detail-slide { min-width: 100%; height: 100%; scroll-snap-align: center; }
        .detail-slide img { width: 100%; height: 100%; object-fit: cover; }
        .detail-body { padding: 20px; }
        .detail-title { font-size: 22px; font-weight: 800; }
        .detail-price { font-size: 20px; color: var(--accent-color); font-weight: 700; margin: 10px 0; }
        .sticky-btn { position: sticky; bottom: 20px; padding: 0 20px; }
        .btn-big { padding: 15px; font-size: 16px; box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3); }

    </style>
</head>
<body>

    <header>
        <img src="https://cdn-icons-png.flaticon.com/512/3063/3063822.png" class="logo">
        <div class="brand-name">Flower Boutique</div>
    </header>

    <!-- 1. –ö–ê–¢–ê–õ–û–ì -->
    <div id="page-catalog" class="page active">
        <div class="grid" id="products-container"></div>
    </div>

    <!-- 2. –ò–°–¢–û–†–ò–Ø (–ó–∞–≥–ª—É—à–∫–∞) -->
    <div id="page-history" class="page">
        <h2>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h2>
        <p style="color: #888">–ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ.</p>
    </div>

    <!-- 3. –ö–û–†–ó–ò–ù–ê -->
    <div id="page-cart" class="page">
        <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
        <div id="cart-list">–ü—É—Å—Ç–æ</div>
        <div style="text-align: right; font-size: 18px; font-weight: bold; margin-top: 20px;">
            –ò—Ç–æ–≥–æ: <span id="cart-total">0</span> ‚ÇΩ
        </div>
        <button class="btn btn-big" style="margin-top: 20px;" onclick="checkout()">–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó</button>
    </div>

    <!-- 4. –ò–ó–ë–†–ê–ù–ù–û–ï -->
    <div id="page-fav" class="page">
        <h2>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ ‚ù§Ô∏è</h2>
        <div id="fav-list" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <!-- –°—é–¥–∞ –ø–æ–ø–∞–¥—É—Ç –ª—é–±–∏–º—ã–µ —Ç–æ–≤–∞—Ä—ã -->
        </div>
        <p id="fav-empty" style="color: #888; display:none">–í—ã –ø–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –ª–∞–π–∫–Ω—É–ª–∏.</p>
    </div>

    <!-- 5. –ü–†–û–§–ò–õ–¨ -->
    <div id="page-profile" class="page">
        <div style="background: var(--secondary-bg); padding: 20px; border-radius: 15px; text-align: center;">
            <div style="width: 80px; height: 80px; background: #ddd; border-radius: 50%; margin: 0 auto 10px;" id="user-ava"></div>
            <h2 id="user-name">–ì–æ—Å—Ç—å</h2>
        </div>
        <div style="margin-top: 20px;">
            <div class="list-item">üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
            <div class="list-item">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û -->
    <div id="product-modal">
        <div class="close-circle" onclick="closeModal()">√ó</div>
        <div class="detail-slider" id="modal-slider"></div>
        <div class="detail-body">
            <div class="detail-title" id="modal-title"></div>
            <div class="detail-price" id="modal-price"></div>
            <h3>–°–æ—Å—Ç–∞–≤</h3>
            <p id="modal-comp"></p>
            <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
            <p id="modal-desc"></p>
        </div>
        <div class="sticky-btn">
            <button class="btn btn-big" id="modal-add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
        </div>
    </div>

    <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ (5 –ö–ù–û–ü–û–ö) -->
    <nav class="tab-bar">
        <button class="tab-btn active" onclick="openTab('catalog', this)">
            <div class="tab-icon">üå∫</div>–ö–∞—Ç–∞–ª–æ–≥
        </button>
        <button class="tab-btn" onclick="openTab('history', this)">
            <div class="tab-icon">üìú</div>–ò—Å—Ç–æ—Ä–∏—è
        </button>
        <button class="tab-btn" style="position: relative;" onclick="openTab('cart', this)">
            <span class="badge" id="cart-badge">0</span>
            <div class="tab-icon">üõí</div>–ö–æ—Ä–∑–∏–Ω–∞
        </button>
        <button class="tab-btn" onclick="openTab('fav', this)">
            <div class="tab-icon">‚ù§Ô∏è</div>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ
        </button>
        <button class="tab-btn" onclick="openTab('profile', this)">
            <div class="tab-icon">üë§</div>–ü—Ä–æ—Ñ–∏–ª—å
        </button>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –ë–ê–ó–ê –î–ê–ù–ù–´–•
        const products = [
            { id: 1, name: "–ë—É–∫–µ—Ç '–ù–µ–∂–Ω–æ—Å—Ç—å'", price: 3500, comp: "–†–æ–∑—ã, –≠–≤–∫–∞–ª–∏–ø—Ç", desc: "–°—Ç–æ–π–∫–∏–µ –∏ –∞—Ä–æ–º–∞—Ç–Ω—ã–µ.", images: ["https://images.unsplash.com/photo-1587575494201-11fe74d90d38?w=400", "https://images.unsplash.com/photo-1562690868-60bbe7293e94?w=400"] },
            { id: 2, name: "101 –†–æ–∑–∞", price: 15000, comp: "–ö—Ä–∞—Å–Ω—ã–µ —Ä–æ–∑—ã", desc: "–ö–ª–∞—Å—Å–∏–∫–∞ –ª—é–±–≤–∏.", images: ["https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=400", "https://images.unsplash.com/photo-1559563362-c667ba5f5480?w=400"] },
            { id: 3, name: "–¢—é–ª—å–ø–∞–Ω—ã", price: 2500, comp: "15 —Ç—é–ª—å–ø–∞–Ω–æ–≤", desc: "–í–µ—Å–µ–Ω–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ.", images: ["https://images.unsplash.com/photo-1520763185298-1b434c919102?w=400", "https://images.unsplash.com/photo-1586944686443-bd287c4d5d4b?w=400"] },
            { id: 4, name: "–ü–∏–æ–Ω—ã", price: 4500, comp: "–ü–∏–æ–Ω—ã –°–∞—Ä–∞ –ë–µ—Ä–Ω–∞—Ä", desc: "–ö—Ä—É–ø–Ω—ã–µ –±—É—Ç–æ–Ω—ã.", images: ["https://images.unsplash.com/photo-1563241527-300027e99740?w=400", "https://images.unsplash.com/photo-1554631221-f9603e6808be?w=400"] },
            { id: 5, name: "–í –∫–æ—Ä–æ–±–∫–µ", price: 5000, comp: "–ú–∏–∫—Å —Ü–≤–µ—Ç–æ–≤", desc: "–ù–µ –Ω—É–∂–Ω–∞ –≤–∞–∑–∞.", images: ["https://images.unsplash.com/photo-1585220177021-d107293ebc56?w=400", "https://images.unsplash.com/photo-1561181286-d3fee7d55364?w=400"] },
            { id: 6, name: "–õ–∞–≤–∞–Ω–¥–∞", price: 1500, comp: "–°—É—Ö–æ—Ü–≤–µ—Ç—ã", desc: "–í–µ—á–Ω—ã–π –±—É–∫–µ—Ç.", images: ["https://images.unsplash.com/photo-1498757581981-8ddb3c0b9b07?w=400", "https://images.unsplash.com/photo-1595123550441-d377e017de6a?w=400"] }
        ];

        let cart = [];
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –∏–∑ –ø–∞–º—è—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        let favorites = JSON.parse(localStorage.getItem('favs')) || [];

        function renderCatalog() {
            const container = document.getElementById('products-container');
            container.innerHTML = '';
            
            products.forEach(p => {
                let slides = '';
                p.images.forEach(img => slides += `<div class="slide"><img src="${img}"></div>`);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ª–∞–π–∫–Ω—É—Ç –ª–∏ —Ç–æ–≤–∞—Ä
                const isFav = favorites.includes(p.id) ? 'active' : '';
                const heartIcon = isFav ? '‚ù§Ô∏è' : 'ü§ç';

                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <div class="fav-icon-overlay ${isFav}" onclick="toggleFav(${p.id}, this, event)">${heartIcon}</div>
                    <div class="slider-wrapper">
                        <div class="slider">${slides}</div>
                        <div class="photo-count">–õ–∏—Å—Ç–∞–π ‚Æï</div>
                    </div>
                    <div class="card-body">
                        <div class="card-title" onclick="openModal(${p.id})">${p.name}</div>
                        <div class="card-price">${p.price} ‚ÇΩ</div>
                        <button class="btn" onclick="addToCart(${p.id})">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                        <button class="btn btn-outline" onclick="openModal(${p.id})">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // --- –õ–û–ì–ò–ö–ê –ò–ó–ë–†–ê–ù–ù–û–ì–û ---
        function toggleFav(id, btn, event) {
            event.stopPropagation(); // –ß—Ç–æ–±—ã –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–ª—Å—è —Ç–æ–≤–∞—Ä –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å–µ—Ä–¥—Ü–µ
            
            const index = favorites.indexOf(id);
            if (index === -1) {
                favorites.push(id); // –î–æ–±–∞–≤–∏—Ç—å
                btn.classList.add('active');
                btn.innerText = '‚ù§Ô∏è';
                tg.HapticFeedback.impactOccurred('medium');
            } else {
                favorites.splice(index, 1); // –£–¥–∞–ª–∏—Ç—å
                btn.classList.remove('active');
                btn.innerText = 'ü§ç';
                tg.HapticFeedback.impactOccurred('light');
            }
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ø–∞–º—è—Ç—å
            localStorage.setItem('favs', JSON.stringify(favorites));
            
            // –ï—Å–ª–∏ –º—ã —Å–µ–π—á–∞—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ - –æ–±–Ω–æ–≤–ª—è–µ–º –µ—ë —Å—Ä–∞–∑—É
            if(document.getElementById('page-fav').classList.contains('active')) {
                renderFavPage();
            }
        }

        function renderFavPage() {
            const container = document.getElementById('fav-list');
            const emptyMsg = document.getElementById('fav-empty');
            container.innerHTML = '';

            if (favorites.length === 0) {
                emptyMsg.style.display = 'block';
                return;
            }
            emptyMsg.style.display = 'none';

            favorites.forEach(favId => {
                const item = products.find(p => p.id === favId);
                if(item) {
                    const div = document.createElement('div');
                    div.className = 'card';
                    div.innerHTML = `
                        <div class="fav-icon-overlay active" onclick="toggleFav(${item.id}, this, event)">‚ù§Ô∏è</div>
                        <img src="${item.images[0]}" style="width:100%; height:120px; object-fit:cover;">
                        <div class="card-body">
                            <div class="card-title">${item.name}</div>
                            <button class="btn" onclick="addToCart(${item.id})">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                        </div>
                    `;
                    container.appendChild(div);
                }
            });
        }

        // --- –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–ö–æ—Ä–∑–∏–Ω–∞, –¢–∞–±—ã, –ú–æ–¥–∞–ª) ---
        function addToCart(id) {
            const item = products.find(p => p.id === id);
            cart.push(item);
            tg.HapticFeedback.impactOccurred('light');
            updateBadge();
            tg.showPopup({ title: '–ì–æ—Ç–æ–≤–æ', message: '–¢–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω–µ', buttons: [{type: 'ok'}] });
        }

        function updateBadge() {
            const badge = document.getElementById('cart-badge');
            badge.style.display = cart.length > 0 ? 'block' : 'none';
            badge.innerText = cart.length;
        }

        function renderCart() {
            const list = document.getElementById('cart-list');
            list.innerHTML = '';
            let total = 0;
            if(cart.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:#888">–ü—É—Å—Ç–æ</p>';
            } else {
                cart.forEach((item, idx) => {
                    total += item.price;
                    list.innerHTML += `
                        <div class="list-item">
                            <img src="${item.images[0]}" class="list-img">
                            <div class="list-info"><b>${item.name}</b><br>${item.price} ‚ÇΩ</div>
                            <div class="list-remove" onclick="removeCart(${idx})">√ó</div>
                        </div>`;
                });
            }
            document.getElementById('cart-total').innerText = total;
        }

        function removeCart(idx) { cart.splice(idx, 1); renderCart(); updateBadge(); }

        function openTab(name, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + name).classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if(name === 'cart') renderCart();
            if(name === 'fav') renderFavPage();
        }

        function openModal(id) {
            const p = products.find(i => i.id === id);
            let slides = '';
            p.images.forEach(img => slides += `<div class="detail-slide"><img src="${img}"></div>`);
            document.getElementById('modal-slider').innerHTML = slides;
            document.getElementById('modal-title').innerText = p.name;
            document.getElementById('modal-price').innerText = p.price + ' ‚ÇΩ';
            document.getElementById('modal-comp').innerText = p.comp;
            document.getElementById('modal-desc').innerText = p.desc;
            document.getElementById('modal-add-btn').onclick = () => { addToCart(id); closeModal(); };
            document.getElementById('product-modal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('product-modal').style.display = 'none'; }

        function checkout() {
            if(cart.length === 0) return;
            const total = cart.reduce((a, b) => a + b.price, 0);
            tg.sendData(JSON.stringify({ total: total, items: cart.map(i => i.name) }));
        }

        // –°—Ç–∞—Ä—Ç
        renderCatalog();
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            document.getElementById('user-name').innerText = tg.initDataUnsafe.user.first_name;
        }
    </script>
</body>
</html>
